generator client {
  provider   = "prisma-client-js"
  output     = "../node_modules/.prisma/client"
  engineType = "client"
}

datasource db {
  provider = "postgresql"
}

model Token {
  id             String              @id @default(cuid())
  mintAddress    String              @unique
  name           String
  symbol         String
  decimals       Int                 @default(9)
  totalSupply    String
  description    String?
  imageUrl       String?
  website        String?
  twitter        String?
  telegram       String?
  creatorWallet  String
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
  deletedAt      DateTime?
  bundles        BundleTransaction[]
  transactions   Transaction[]
  volumeBotPairs VolumeBotPair[]

  @@index([creatorWallet])
  @@index([createdAt])
  @@index([mintAddress])
  @@index([deletedAt])
}

model Transaction {
  id                   String   @id @default(cuid())
  signature            String?  @unique
  tokenId              String
  type                 String
  walletAddress        String
  amount               String
  solAmount            String?
  price                String?
  networkFeeLamports   String?
  networkFeeSol        String?
  jitoTipSol           String?
  priorityFeeSolBudget String?
  error                String?
  status               String   @default("pending")
  createdAt            DateTime @default(now())
  token                Token    @relation(fields: [tokenId], references: [id])

  @@index([tokenId])
  @@index([walletAddress])
  @@index([createdAt])
  @@index([type])
}

model VolumeBotPair {
  id              String             @id @default(cuid())
  tokenId         String
  isActive        Boolean            @default(false)
  minAmount       String
  maxAmount       String
  intervalSeconds Int // Legacy or used as default/average
  minIntervalSeconds Int           @default(30)
  maxIntervalSeconds Int           @default(120)
  numberOfWallets Int                @default(1)
  randomDelays    Boolean            @default(true)
  antiDetection   Boolean            @default(true)
  totalTrades     Int                @default(0)
  totalVolume     String             @default("0")
  solSpent        String             @default("0")
  status          String             @default("stopped")
  lastRunAt       DateTime?
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
  logs            BotLog[]
  token           Token              @relation(fields: [tokenId], references: [id])
  settings        VolumeBotSettings?

  @@index([tokenId])
  @@index([isActive])
  @@index([status])
}

model VolumeBotSettings {
  id            String        @id @default(cuid())
  pairId        String        @unique
  mode          String        @default("wash")
  amountMode    String        @default("random")
  fixedAmount   String        @default("0.01")
  minAmount     String        @default("0.005")
  maxAmount     String        @default("0.02")
  minPercentage String        @default("5")
  maxPercentage String        @default("20")
  slippage      String        @default("10")
  priorityFee   String        @default("0.005")
  jitoTip       String        @default("0.0001")
  jitoRegion    String        @default("frankfurt")
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  pair          VolumeBotPair @relation(fields: [pairId], references: [id], onDelete: Cascade)

  @@index([pairId])
}

model BotLog {
  id        String        @id @default(cuid())
  pairId    String
  message   String
  type      String        @default("info")
  metadata  Json?
  createdAt DateTime      @default(now())
  pair      VolumeBotPair @relation(fields: [pairId], references: [id], onDelete: Cascade)

  @@index([pairId])
  @@index([type])
  @@index([createdAt])
}

model Bundle {
  id           String              @id @default(cuid())
  bundleId     String              @unique
  status       String              @default("pending")
  txCount      Int
  successCount Int                 @default(0)
  failedCount  Int                 @default(0)
  gasUsed      String?
  createdAt    DateTime            @default(now())
  completedAt  DateTime?
  transactions BundleTransaction[]

  @@index([status])
  @@index([createdAt])
}

model BundleTransaction {
  id            String   @id @default(cuid())
  bundleId      String
  tokenId       String?
  walletAddress String
  amount        String
  type          String
  status        String   @default("pending")
  signature     String?
  createdAt     DateTime @default(now())
  bundle        Bundle   @relation(fields: [bundleId], references: [id])
  token         Token?   @relation(fields: [tokenId], references: [id])

  @@index([bundleId])
  @@index([walletAddress])
}

model Stats {
  id              String   @id @default(cuid())
  date            DateTime @unique @default(now())
  activeTokens    Int      @default(0)
  totalVolume24h  String   @default("0")
  bundledTxs      Int      @default(0)
  holdersGained   Int      @default(0)
  volumeBotTrades Int      @default(0)
  volumeBotVolume String   @default("0")

  @@index([date])
}

model Wallet {
  id           String              @id @default(cuid())
  publicKey    String              @unique
  secretKey    String
  label        String?
  role         String              @default("project")
  solBalance   String              @default("0")
  tokenBalance String              @default("0")
  isActive     Boolean             @default(true)
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt
  groups       WalletGroupWallet[]

  @@index([publicKey])
  @@index([isActive])
  @@index([createdAt])
}

model WalletGroup {
  id          String              @id @default(cuid())
  name        String
  description String?
  type        String              @default("custom")
  isActive    Boolean             @default(true)
  createdAt   DateTime            @default(now())
  updatedAt   DateTime            @updatedAt
  wallets     WalletGroupWallet[]

  @@index([type])
  @@index([isActive])
}

model WalletGroupWallet {
  id        String      @id @default(cuid())
  groupId   String
  walletId  String
  createdAt DateTime    @default(now())
  group     WalletGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)
  wallet    Wallet      @relation(fields: [walletId], references: [id], onDelete: Cascade)

  @@unique([groupId, walletId])
  @@index([groupId])
  @@index([walletId])
  @@index([groupId, walletId])
}

model FunderWallet {
  id        String        @id @default(cuid())
  publicKey String        @unique
  label     String?
  isActive  Boolean       @default(true)
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  topups    FunderTopup[]

  @@index([publicKey])
  @@index([isActive])
}

model FunderTopup {
  id             String       @id @default(cuid())
  funderWalletId String
  fromPublicKey  String
  amountLamports String
  signature      String?      @unique
  status         String       @default("submitted")
  createdAt      DateTime     @default(now())
  funderWallet   FunderWallet @relation(fields: [funderWalletId], references: [id], onDelete: Cascade)

  @@index([funderWalletId])
  @@index([fromPublicKey])
  @@index([createdAt])
}
